define(function(){location.href.indexOf("b5m.com")>-1&&(document.domain="b5m.com");var e={ie6:function(){return"undefined"==typeof document.getElementsByTagName("body")[0].style.maxHeight},insertNum:120,shareTxt:function(){var e=this,t=$(".popwindow-share-txt",".popwindow-share"),n=t.attr("msg");t.focus(function(){var e=$(this),t=e.val().replace(/\s+/gi,"");n.replace(/\s+/gi,"")==t&&e.val("").css("color","#333")}).blur(function(){var e=$(this),t=e.val().replace(/\s+/gi,"");n.replace(/\s+/gi,"")==t||""==t?e.val(n).css("color","#999"):e.css("color","#333")}).trigger("blur");var o=$(".popwindow-share-txtCanInsertNum");t.on({keyup:function(){var t=$(this),i=t.val(),a=i.length,s=e.insertNum-a;return i==n?void o.text(e.insertNum):(20>s?o.css("color","#f00"):o.removeAttr("style"),void(a>=e.insertNum?(t.val(i.substr(0,e.insertNum)),o.text(0)):o.text(s)))}}),$(".popwindow-share-close",".popwindow-share").click(function(){$(".popwindow-share").remove()})},popwindowClose:function(){$(".popwindow-share").remove()},authClose:function(){$("#share-auth").remove()},auth:function(e){var t='<div id="share-auth"><iframe src="http://ucenter.b5m.com/user/third/login/auth.htm?type='+(e||1)+'&isIframe=1&refererUrl=&api=/setToken" frameborder="0" width="800" height="460"></iframe><u class="popwindow-share-close"></u></div>',n=this;$(t).appendTo($("body")),$(".popwindow-share-close").click(function(){n.authClose()})},setHref:function(e){this._href=e,this._mhref=e},setContent:function(e){this._content=e},init:function(e){var t=$.extend({shareMode:!0,id:".box-share-ico",title:"帮5买",icontype:1,href:window.location.href,content:"帮5买，帮您轻松选择的比价网",pic:!1,params:[],dataMps:"",activityId:"",successFun:function(){},errorFun:function(){}},{},e||{}),n='<div class="box-popShare type'+t.icontype+'" data-mps="'+t.dataMps+'"><span class="share-ico share-sina" attr-type="2"></span><span class="share-ico share-qzone" attr-type="1" attr-sync="1"></span><span class="share-ico share-weibo" attr-type="1"></span><span class="share-ico share-weixin"></span></div>',o=$(t.id),i=this,a=t.params,s=t;t.pic||delete t.pic,t.shareMode?o.on({click:function(){var e=$.extend({},s);i.click(e,this)}},".share-ico"):$.each(a,function(e,t){$(t.id).click(function(){i.click(t,i)})}),o.find(".box-popShare").length||$(n).appendTo(o)},click:function(e,t){var n=this;if(e.href=n._href?n._href:e.href,e.mhref=n._mhref?n._mhref:e.mhref?e.mhref:e.href,e.content=n._content?n._content:e.content,$(t).hasClass("share-weixin"))return _url=function(){return-1!==location.hostname.indexOf("stage.bang5mai.com")?"ucenter.stage.bang5mai.com":-1!==location.hostname.indexOf("prod.bang5mai.com")?"ucenter.prod.bang5mai.com":-1!==location.hostname.indexOf("ucenter.test.com")?"ucenter.test.com":/^\d+\./.test(location.hostname)?location.hostname:"ucenter.b5m.com"}(),window.open("http://"+_url+"/user/third/share/weixin.htm?content="+encodeURIComponent(e.content)+"&url="+encodeURIComponent(e.mhref)),!1;var o=$(t),i="http://ucenter.b5m.com",a=o.attr("attr-type"),s=o.attr("attr-sync");e.type?a=e.type:e.type=a,$.ajax({url:i+"/user/third/getToken.htm",dataType:"jsonp",jsonp:"jsonpCallback",async:!1,data:{state:a},success:function(t){t&&1==t.ok?n.popwindow(e,function(t){var o=i+"/user/third/share.htm",r={state:a,summary:t.content,title:t.title,activityId:t.activityId};1==a?r.url=t.href:r.summary=r.summary+"  "+t.href,t.pic&&(r.images=t.pic),1==a&&(s?r.nswb=s:r.comment=t.content),$.ajax({type:"POST",url:o,data:r,dataType:"jsonp",jsonp:"jsonpCallback",headers:{Accept:"application/json; charset=utf-8","Content-Type":"application/x-www-form-urlencoded"},success:function(t){t.ok?(n.popwindowClose(),alert("分享成功"),e.successFun()):alert("6666"==t.code||6666==t.code?t.data:"分享失败，请稍后分享/请检查您的空间或微博是否开通")}})}):0==t.ok&&n.auth(a)}})},popwindow:function(e,t){var n,o=$.extend({},{title:"帮5买值得买频道",href:"http://www.b5m.com",content:"",type:1,pic:[],fun:!1},e||{}),i='<div class="popwindow-share"><div class="popwindow-share-insert"><h3>分享<span>还能输入<b class="popwindow-share-txtCanInsertNum">120</b>个字符</span></h3><textarea class="popwindow-share-txt" msg="请输入分享内容...">'+o.content+"</textarea><p><b>分享来自“"+o.title+'”</b><a href="'+o.href+'" target="_blank">'+o.href+"</a></p></div>",a=this,s=0;if(o.pic.length>0){for(var r,c="",p=0;p<o.pic.length;p++)c+='<span><img src="'+o.pic[p]+'"/><s></s></span>';r='<div class="popwindow-share-pic"><p><input type="checkbox" id="popwindow-share-piccheckbox" value="1" class="popwindow-share-piccheckbox" checked/><label for="popwindow-share-piccheckbox">同时分享选中图片</label></p><div class="popwindow-share-picbox"><div class="ov"><div class="popwindow-share-cont ov">'+c+'</div></div><s class="popwindow-share-pic-next"><u></u></s><s class="popwindow-share-pic-prev"><u></u></s></div></div>',i+=r}if(i+='<div class="popwindow-share-btbox"><span class="popwindow-share-subBt">分享</span><a href="http://ucenter.b5m.com/user/third/login/auth.htm?type='+o.type+'&refererUrl=&api=/setToken" class="popwindow-share-transit" target="_blank">换个账号分享</a></div><s class="popwindow-share-close"></s></div>',$(i).appendTo($("body")),n=$(".popwindow-share"),s=n.outerHeight(!0),"undefined"==typeof document.body.style.maxWidth){var h=$(window).height();$(window).resize(function(){h=$(window).height()}),$(window).scroll(function(){n.css("top",(h-s)/2+$(this).scrollTop()+"px")}).trigger("scroll")}else n.css("marginTop","-"+s/2+"px");return a.shareTxt(),o.pic.length>0&&($("span:first",".popwindow-share-cont").addClass("cur"),a.imgScroll(),a.sltShareImg()),$(".popwindow-share-subBt",".popwindow-share").click(function(){var e={},n=$(".popwindow-share-txt");n.attr("msg")==n.val(),e.title=o.title,e.href=o.href,e.activityId=o.activityId,e.content=n.val(),o.pic.length>0&&$("#popwindow-share-piccheckbox").is(":checked")&&(e.pic=$(".cur>img",".popwindow-share-cont").attr("src")),t&&t(e),o.fun&&o.fun(e)}),this},imgScroll:function(e){var t,n=$.extend({},{auto:!1},e||{}),o=".popwindow-share-picbox",i=".popwindow-share-cont",a=4e3;if($("span",i).length<5)return $(".popwindow-share-pic-next,.popwindow-share-pic-prev",o).css("opacity","0.3"),this;var s=function(){var e=$("span:first",i),t=$(i);t.animate({marginLeft:"-="+e.outerWidth(!0)},function(){t.append(e).removeAttr("style")})},r=function(){var e=$("span:last",i),t=$(i),n=e.outerWidth(!0);t.prepend(e).css("marginLeft","-"+n+"px").animate({marginLeft:"+="+n})};return n.auto&&$(o).hover(function(){clearInterval(t)},function(){t=setInterval(function(){s()},a)}).trigger("mouseout"),$(".popwindow-share-pic-next,.popwindow-share-pic-prev",o).on({click:function(){var e=$(this);e.hasClass("popwindow-share-pic-next")?r():s()}}),this},sltShareImg:function(){$("span",".popwindow-share-cont").click(function(){if(!$("#popwindow-share-piccheckbox").is(":checked"))return!1;var e=$(this);return 0==e.find("s").length&&e.append("<s></s>"),e.addClass("cur").siblings().removeClass("cur"),this})}};return window.popWindowShareFed={authClose:function(){$("#share-auth").remove()}},e});