function CartCenter(t){this.docId=t.docId||"",this.url=t.url||"",this.priceAvg=t.priceAvg||"",this.ref=t.ref||"",this.paramurl=t.paramurl||"",this.origin=t.origin||"",this.subPrice=Number(t.subPrice)||0,this.key=t.key||t.docId,this.price=t.price||"",this.title=t.title,this.imgPath=t.imgPath}function getJsonLength(t){var i=0;for(var e in t)i++;return i}function getCookie(t){for(var i=document.cookie,e=i.split("; "),n=0;n<e.length;n++){var a=e[n].split("=");if(a[0]==t)return a[1]}return""}function hideSKU(t,i,e){if(""==i)return void $(".gg_prop a").removeClass("off");var n=i.split(";"),a=n.length,r=t.sku,o=[];$(".centrt-sku .gg_key").each(function(){var t=$(this).text();t=t.replace("：",":"),o.push(t)});var s=$(".centrt-sku .checked");$(".gg_prop a").not(s).not(e).each(function(){var t=$(this).text(),i=$(this).parent().prev().text(),e=[],s="",u=$(this).siblings(".checked"),d=i+t,l=i+u.text();if(u.length)for(var c=0;a>c;c++)l!=n[c]&&e.push(n[c]);else e=n.concat();e.push(d),e=sortList(o,e),s=e.join(";");var m=new RegExp(s),p=!1;for(var g in r)if(m.test(g)){p=!0;break}p?$(this).removeClass("off"):$(this).addClass("off")})}function sortList(t,i){for(var e=[],n="",a=0;a<t.length;a++){for(var r=!1,o=t[a],s=0;s<i.length;s++)if(i[s].indexOf(o)>-1){r=!0,n=i[s];break}e.push(r?n.replace(/([\(\)\.\?\+\{\}\[\]\-\=\^\$\*])/g,"\\$1"):"[^;]*;*")}return e}function jumpTo(t){var i=document.createElement("a");if(document.body.appendChild(i),i.href=t,i.target="_blank",i.click)i.click();else try{var e=document.createEvent("Event");e.initEvent("click",!0,!0),i.dispatchEvent(e)}catch(n){window.localhost.href=t}}window.plan_limit_ids=window.plan_limit_ids||[],CartCenter.prototype.init=function(){var t=this;$(".centre-details-quantity").on("click",".btn-subtraction:not(.dis)",function(){if(!$(this).hasClass("p-reduceno")){var e=$("#quantity005").val(),n=1*window.minimum_purchase_number||1,a=1*$(".maxNum").val();e=Number(Number(e)-Number(1)),n>=a?$("#quantity005").val(a):e>=n?$("#quantity005").val(e):e>n&&$("#quantity005").val(n),e=$("#quantity005").val(),t.modifyPrice(e)}i()}),$(".centre-details-quantity").on("click",".btn-add:not(.dis)",function(){var e=$("#quantity005").val(),n=1*$(".maxNum").val();window.plan_limit_num&&Number(window.plan_limit_num)<Number(n)&&(n=Number(window.plan_limit_num)),Number(n)>0?Number(n)>Number(e)&&(e=Number(Number(e)+Number(1))):e=Number(Number(e)+Number(1)),$("#quantity005").val(e),i(),t.modifyPrice(e)}),$("#quantity005").keyup(function(){var t=1*window.minimum_purchase_number,e=1*$(".maxNum").val();setTimeout(function(){(isNaN(1*$("#quantity005").val())||1*$("#quantity005").val()<=t)&&(t>e?($("#quantity005").val(e),$(".btn-add").addClass("dis")):$("#quantity005").val(t))},800);var n=Number($(".maxNum").val())||Number($(".quantity").text());window.plan_limit_num&&Number(window.plan_limit_num)<Number(n)&&(n=Number(window.plan_limit_num)),Number($("#quantity005").val())>=n&&$("#quantity005").val(n),i()}),$(".error-close").click(function(){t.closeggts()});var i=function(){var t=Number($(".maxNum").val()),i=window.minimum_purchase_number;window.plan_limit_num&&Number(window.plan_limit_num)<t&&(t=Number(window.plan_limit_num)),Number($("#quantity005").val())>i?$(".btn-subtraction").removeClass("dis"):$(".btn-subtraction").addClass("dis"),Number($("#quantity005").val())<t?$(".btn-add").removeClass("dis"):$(".btn-add").addClass("dis")};i()},CartCenter.prototype.closeggts=function(){$(".centre-details-r").removeClass("error"),$(".centre-error-msg").hide()},CartCenter.prototype.modifyPrice=function(a){var b=$(".total-product-price").attr("data"),d=0;b>10&&(d=this.subPrice*a,d>10&&(d=10)),b>=10?$(".coupon-info").show():$(".coupon-info").hide(),a=1;var c=parseFloat(b)*a-d;if("string"==typeof window.goods_signal&&""!=window.goods_signal){var goods_signal_data=eval("("+window.goods_signal+")");if("undefined"!=typeof goods_signal_data.discountprice&&"undefined"!=typeof goods_signal_data.discountprice.name&&"undefined"!=typeof goods_signal_data.discountprice.price)if("手机专享价"==goods_signal_data.discountprice.name);else{c=Math.round(100*new Number(c).toFixed(2))/100;var strs=goods_signal_data.discountprice.price.split("-"),price_min=0,price_max=0;"undefined"!=typeof strs[0]&&(price_min=strs[0]),"undefined"!=typeof strs[1]&&(price_max=strs[1]),price_min=Math.round(100*new Number(price_min).toFixed(2))/100,price_max=Math.round(100*new Number(price_max).toFixed(2))/100,price_min>price_max&&(price_max=price_min),c>=price_min&&price_max>=c||(c=price_max)}}$(".total-product-price").text(new Number(c)),0>c&&$(".total-product-price").text("暂无报价")},CartCenter.prototype.soldOut=function(){$(".btn-red-two").hide(),$(".btn-orange").hide(),$(".btn-sold-out").show(),$(".btn-sold-err").show()},CartCenter.prototype.displayGuige=function(t){if($(".sku-info").show(),$("#skuLoad").hide(),this.clickBtn(),$(".centrt-sku-down").hide(),0==t.status)return this.soldOut(),void $("dl.centrt-sku").hide();var i=t;if(i.cityNames){SaleCommJs.areaLimitShow(i.cityNames,"clearfix")}if(i.limitCount&&$("#limitCount").val(i.limitCount),!i.sku||!i.skuProps||i.skuProps.length<1)return void $(".centrt-sku-down").show();if(!t||!t.sku||!t.skuProps||t.skuProps.length<1)return void($(".gg_key").length<=0&&$(".centrt-sku-down").show());var e=$(".centre-details-quantity").prev();e.siblings(".gg_key").remove(),e.siblings(".gg_prop").remove();var n="",a=!1;t.skuImgs&&(a=!0);for(var r=0;r<t.skuProps.length;r++){var o=t.skuProps[r];n=n+'<dt class="gg_key">'+o.name+'：</dt><dd class="gg_prop centrt-sku-color">';for(var s=0;s<o.props.length;s++){var u=t.skuImgs[o.props[s]];n=o.name.indexOf("颜色")>=0?a&&u&&u.smallImgUrl&&u.imgUrl?n+'<a class="pic" data-url="'+u.imgUrl+'" title="'+o.props[s]+'"><em class="vertical-center"><img src="'+u.smallImgUrl+'"></em><b>'+o.props[s]+"</b></a>":n+'<a class="pic">'+o.props[s]+"</a>":n+"<a>"+o.props[s]+"</a>"}n+="</dd>"}if(e.before(n),this.guigeAddEvent(t),getJsonLength(t.sku)>=1){var d=1;$(".gg_prop").each(function(){var t=$(this).children("a").length;t>1&&(d=0)}),d&&($(".gg_prop").each(function(){$(this).children("a").eq(0).click()}),$(".details-small-img img").eq(0).attr("src")&&$(".details-big-img img").attr("src",$(".details-small-img img").eq(0).attr("src")))}$(".gg_prop").each(function(){window.isInitImg=!0,1==$(this).find("a").length&&$(this).find("a").click()})},CartCenter.prototype.guigeAddEvent=function(t){var i=this,e=$(".gg_prop");e.find("a").click(function(){var n=$(this);if(!n.hasClass("off")){n.addClass("checked").siblings().removeClass("checked"),null==n.attr("data-url")||window.isInitImg||$(".details-big-img img").attr("src",n.attr("data-url")),window.isInitImg&&(window.isInitImg=!1),$(".gg_prop a.checked").length==e.length&&i.closeggts();var a=i.getGoodsSpec();""!=a?($(".selected-info").show(),$(".selected-info span").html("“"+a.replace(";","、  ")+"“")):$(".selected-info").hide();var r,o,s=t.sku[a];if(s&&(r=t.sku[a].price,o=t.sku[a].quantity),!s&&t.sku){var u=0;if(a||(u=$("#quantity_summa").html()),a)for(var d in t.sku)-1!=d.indexOf(a)&&t.sku[d].quantity&&(u+=t.sku[d].quantity);o=u}if("undefined"==typeof o&&(o=0),o=Math.round(o)){$(".surplus").show(),$(".quantity").text(o);var l=1*window.minimum_purchase_number||1;l>o?($(".btn-add").addClass("dis"),$(".btn-subtraction").addClass("dis")):($("#quantity005").val(l),$(".btn-add").removeClass("dis"),$(".btn-subtraction").addClass("dis"));var c=$("#quantity005").val();c>o&&$("#quantity005").val(o),$(".maxNum").val(o),$(".btn-sold-ok").show(),$(".btn-sold-err").hide()}else{$(".surplus").hide(),$(".quantity").text(o),$(".maxNum").val(0),$("#quantity005").val(0),$(".btn-sold-ok").hide(),$(".btn-sold-err").show();var m=$("#quantity_summa").attr("id");"undefined"!=typeof m&&($(".btn-sold-ok").hide(),$(".btn-sold-err").show())}var p=$("#quantity_summa").html();o>p&&$(".quantity").text(p),r?($(".total-product-price").attr("data",r),i.modifyPrice(Number($("#quantity005").val())),$(".origin-price").length&&$(".origin-price").find("span").html("&yen;"+t.sku[a].ori_info.highPrice),$(".vip-price").length&&$(".vip-price").find("span").html("&yen;"+t.sku[a].ori_info.vipPrice)):($(".total-product-price").attr("data",r),i.modifyPrice(Number($("#quantity005").val()))),hideSKU(t,a,n)}var g=$("#tid").val(),f=window.plan_limit_ids;for(var h in f)g==f[h]&&$(".btn-orange").hide()})},CartCenter.prototype.oneSpec=function(t){var i=t.parent().prev().text(),e=t.text();return i+e+";"},CartCenter.prototype.haveSelGuige=function(){var t=$(".price-line .b5m-price").text();if(isNaN(t))return $(".sku-tips").addClass("show-tips"),!1;var i=$(".sku-info .sku-item").find(".opt:not(.disabled)").hasClass("selected");return i?($(".sku-tips").removeClass("show-tips"),!0):($(".sku-tips").addClass("show-tips"),!1)},CartCenter.prototype.clickBtn=function(){var t=this;$(".btn-orange").off("click"),$(".btn-red-two").off("click"),$(".btn-orange,.add-cart").click(function(){return t.haveSelGuige()?b5m.ui.isULogin.isNoLogin(function(){SaleCommJs.reflashLogin(),t.addCart(function(t){if(1!=t.code)return void alert(t.msg);try{b5m.ui.setProductNum()}catch(i){}$("#DetailDialog").show()})})?null:void 0:void($(this).is(".add-cart")&&$("html,body").animate({scrollTop:$(".sku-tips").offset().top}))}),$(".sku-tips").on("click",".close",function(){$(".sku-tips").removeClass("show-tips")}),$(".add-cart-success").on("click",".cart-close",function(){$("#DetailDialog").hide()}),$(".add-cart-success").on("click",".go-shoping",function(){$("#DetailDialog").hide()}),$(".btn-red-two").click(function(){return t.haveSelGuige()?$(this).hasClass("not-allow")?!1:b5m.ui.isULogin.isNoLogin(function(){SaleCommJs.reflashLogin(),t.addCart(function(t){return 1!=t.code?alert(t.msg):t.val_form?$("body").append(t.val_form):location.href=t.val,!1},1);try{b5m.ui.setProductNum()}catch(i){}})?!1:!0:(document.documentElement.scrollTop=0,document.body.scrollTop=0,!1)})},CartCenter.prototype.addCart=function(t,i){var e=this,n=e.docId,a=(e.priceAvg,e.getGoodsSpec());a&&""!=a||(a=$("#beizhu").val());var r=$(".good-num input.num").val();if(0>=r)return alert("暂时不能购买"),!1;var o=$("#quantity_summa").attr("id");if("undefined"!=typeof o){var s=$("#quantity_summa").html();if(0>=s)return alert("商品被下架、删除、库存不足,暂时不能购买"),!1}var u=$("#tid").val(),d=0,l=window.plan_limit_ids;for(var c in l)u==l[c]&&Math.round(100*new Number(r).toFixed(2))>Math.round(100*new Number(window.plan_limit_num).toFixed(2))&&(d=1);if("undefined"!=typeof window.is_limit_one_buy&&1==window.is_limit_one_buy&&(d=1),d)return alert("抱歉，该商品限购，只能限购"+window.plan_limit_num+"件"),!1;var m=window.location.href;if(m.indexOf("mps=")>0){var p=m.split("mps=")[1];p.indexOf("&")>0&&(p=p.split("&")[0]),e.origin=p}else e.origin=getCookie("_b5mtraffic");var g={goodsWay:$("#goodsWay").val(),tid:$("#tid").val(),pid:$("#pid").val(),goodsTip:1,docId:n,priceAvg:$(".total-product-price").attr("data"),goodsSpec:a,count:r,ref:e.ref,origin:e.origin,url:e.paramurl,direct_buy:i,key:e.key,price:$(".total-product-price").attr("data"),title:e.title,imgPath:$(".details-big-img img").attr("src")?$(".details-big-img img").attr("src"):e.imgPath};"undefined"!=typeof window.goods_signal&&(g.goods_signal=goods_signal),"undefined"!=typeof window.sku_signal&&(g.sku_signal=sku_signal),$.ajax({type:"POST",url:ajaxToCartUrl+"",async:!1,dataType:"json",data:g,success:function(i){t(i)}})},CartCenter.prototype.getGoodsSpec=function(){var t={};$("input.sku-input").each(function(){var i=$(this),e=i.val();e&&(t[i.data("desc").replace(":","")]=e)});var i,e="",n=";";for(i in t){var a=i+":"+t[i];e+=(e?n:"")+a}return e},CartCenter.prototype.removeLastSemicolon=function(t){return t.length>0&&";"==t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),t};